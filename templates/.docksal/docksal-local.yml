# Basic LAMP stack
version: "2.1"
services:
  # CLI
  cli:
    environment:
      - ANDOCK=1
      - ANDOCK_ENVIRONMENT={{ branch }}
      - ANDOCK_ALIAS={{ alias }}
    volumes:
      - project_root:/var/www:ro,nocopy
{% if mounts %}
    {% for mount in mounts %}
  - {{ mount.name }}:/var/www/{{ mount.path }}:rw
    {% endfor %}
{% endif %}

  web:
    labels:
      - io.docksal.virtual-host={% for virtual_host in virtual_hosts %}{{ virtual_hosts[virtual_host] }}{% if not loop.last %},{% endif %}{% endfor %}

    environment:
      - ANDOCK_CI=1
{% if mounts %}
    volumes:
    {% for mount in mounts %}
  - {{ mount.name }}:/var/www/{{ mount.path }}:rw
    {% endfor %}
{% endif %}

{% if mounts %}
volumes:
{% for mount in mounts %}
  {{ mount.name }}:  # Project root volume (bind)
    driver: local
    driver_opts:
      type: none
      device: {{ mount_path }}/{{ mount.name }}
      o: bind
{% endfor %}
{% endif %}